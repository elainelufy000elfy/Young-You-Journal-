<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mood Journal</title>
  <style>
    body {
      --left-color: #84c7ae;
      --right-color: #ffffff;
      background: linear-gradient(to right, var(--left-color), var(--right-color));
      background-size: 200% 200%;
      animation: breathe 10s ease-in-out infinite;
      transition: background 2s ease;
    }

    /* Calm breathing animation */
    @keyframes breathe {
      0%, 100% { background-position: left center; }
      50% { background-position: right center; }
    }

    .milestone {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      background: #ffde59;
      padding: 0.75rem 1.5rem;
      border-radius: 20px;
      font-weight: bold;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      animation: fadeInOut 4s ease-in-out;
      z-index: 999;
    }

    @keyframes fadeInOut {
      0%,100% { opacity: 0; }
      10%,90% { opacity: 1; }
    }

    @media (max-width: 600px) {
      .milestone { font-size: 0.9rem; padding: 0.6rem 1rem; }
    }
  </style>
</head>
<body>

<script>
const emotionInput = document.getElementById('emotion');
const healthInput = document.getElementById('health');
const saveBtn = document.getElementById('saveBtn');
const progressBar = document.getElementById('progressBar');
const message = document.getElementById('message');
const entriesDiv = document.getElementById('entries');
const firework = document.getElementById('firework');
const colorPicker = document.getElementById('colorPicker');
const mainContainer = document.getElementById('mainContainer');
const journal = document.getElementById('journal');
const cycleBtn = document.getElementById('cycleBtn');
const backBtn = document.getElementById('backBtn');

// Mood UI
const moodRow = document.getElementById('moodRow');
const moodDot = document.getElementById('moodDot');
const moodLabel = document.getElementById('moodLabel');
const moodScore = document.getElementById('moodScore');
const moodStatus = document.getElementById('moodStatus');

// Storage & base color
let entries = JSON.parse(localStorage.getItem('entries')) || [];
let baseColor = localStorage.getItem('baseColor') || '#84c7ae';
colorPicker.value = baseColor;

// Track last color for gradient
let lastColor = localStorage.getItem('lastColor') || baseColor;

// === Helpers: color conversions ===
function hexToHSL(hex) {
  let r=0,g=0,b=0;
  if(hex.length==4){r="0x"+hex[1]+hex[1]; g="0x"+hex[2]+hex[2]; b="0x"+hex[3]+hex[3];}
  else if(hex.length==7){r="0x"+hex[1]+hex[2]; g="0x"+hex[3]+hex[4]; b="0x"+hex[5]+hex[6];}
  r=+r/255; g=+g/255; b=+b/255;
  const max=Math.max(r,g,b), min=Math.min(r,g,b);
  let h,s,l=(max+min)/2;
  if(max===min){h=s=0;} 
  else {
    const d=max-min;
    s=l>0.5?d/(2-max-min):d/(max+min);
    switch(max){
      case r: h=(g-b)/d+(g<b?6:0); break;
      case g: h=(b-r)/d+2; break;
      case b: h=(r-g)/d+4; break;
    }
    h/=6;
  }
  return {h:Math.round(h*360), s:Math.round(s*100), l:Math.round(l*100)};
}

function hslToHex(h,s,l){
  s/=100;l/=100;
  const c=(1-Math.abs(2*l-1))*s;
  const x=c*(1-Math.abs((h/60)%2-1));
  const m=l-c/2;
  let r=0,g=0,b=0;
  if(0<=h&&h<60){r=c; g=x; b=0;}
  else if(60<=h&&h<120){r=x; g=c; b=0;}
  else if(120<=h&&h<180){r=0; g=c; b=x;}
  else if(180<=h&&h<240){r=0; g=x; b=c;}
  else if(240<=h&&h<300){r=x; g=0; b=c;}
  else{r=c; g=0; b=x;}
  const to255=v=>Math.round((v+m)*255);
  const toHex=v=>v.toString(16).padStart(2,'0');
  return `#${toHex(to255(r))}${toHex(to255(g))}${toHex(to255(b))}`;
}

// === Breathing Gradient Background ===
function setBackground(fromColor=lastColor, toColor='#ffffff', emotionLevel=0.5, speedFactor=10){
  const hslFrom=hexToHSL(fromColor);
  const hslTo=hexToHSL(toColor);
  const saturationFrom=20+(emotionLevel*60);
  const lightnessFrom=40+(emotionLevel*30);
  const gradient=`linear-gradient(90deg,
    hsl(${hslFrom.h}, ${saturationFrom}%, ${lightnessFrom}%),
    hsl(${hslTo.h}, ${hslTo.s}%, ${hslTo.l}%)
  )`;
  document.body.style.setProperty('--left-color', `hsl(${hslFrom.h}, ${saturationFrom}%, ${lightnessFrom}%)`);
  document.body.style.setProperty('--right-color', `hsl(${hslTo.h}, ${hslTo.s}%, ${hslTo.l}%)`);
  document.body.style.background = gradient;
  document.body.style.transition = 'background 1.5s ease';

  const duration = Math.max(4,12-(emotionLevel*8));
  document.body.style.animationDuration = `${duration}s`;
}

// === Progress/messages ===
function updateProgress(){
  const total=10;
  const percent=Math.min((entries.length/total)*100,100);
  progressBar.style.width = percent+'%';
  if(entries.length===0) message.textContent="Start by recording your first feeling ðŸ’š";
  else if(entries.length<total/2) message.textContent="Keep going â€” youâ€™re learning to care for yourself ðŸŒ±";
  else if(entries.length<total) message.textContent="Youâ€™re almost there â€” growth takes time ðŸŒ»";
  else{
    message.textContent="Youâ€™ve completed your cycle of growth ðŸŒ¸";
    firework.style.display='flex';
    setTimeout(()=>firework.style.display='none',3000);
  }
}

// === Render Entries ===
function renderEntries(){
  entriesDiv.innerHTML='';
  entries.forEach((e,i)=>{
    const div=document.createElement('div');
    div.className='entry';
    div.innerHTML=`<strong>Day ${i+1}</strong><br>Feeling: ${e.emotion}<br>Health: ${e.health}`;
    entriesDiv.appendChild(div);
  });
}

// === Entry Counter & Milestone every 5 ===
let entryCount=parseInt(localStorage.getItem('entryCount')||'0');
function showMilestone(count){
  const milestone=document.createElement('div');
  milestone.className='milestone';
  milestone.textContent=`ðŸŽ‰ Youâ€™ve entered ${count} moods! Keep it up!`;
  document.body.appendChild(milestone);
  setTimeout(()=>milestone.remove(),4000);
}

// === Save Button Handler ===
saveBtn.addEventListener('click', ()=>{
  const emotion=emotionInput.value.trim();
  const health=healthInput.value;
  if(!emotion) return alert('Please share how you feel ðŸŒ¼');

  entries.push({emotion, health});
  entryCount++;
  localStorage.setItem('entries', JSON.stringify(entries));
  localStorage.setItem('entryCount', entryCount);

  updateProgress();
  emotionInput.value='';
  healthInput.value='';

  if(entryCount%5===0) showMilestone(entryCount);
});

// === Navigation ===
cycleBtn.addEventListener('click', ()=>{
  mainContainer.style.display='none';
  journal.style.display='flex';
  renderEntries();
});
backBtn.addEventListener('click', ()=>{
  journal.style.display='none';
  mainContainer.style.display='block';
});

// === Color Picker ===
colorPicker.addEventListener('input',(e)=>{
  baseColor=e.target.value;
  localStorage.setItem('baseColor', baseColor);
  setBackground(lastColor, baseColor, 0.5);
});

// Initial paint
setBackground('#ffffff', baseColor, 0.5);
updateProgress();
</script>

</body>
</html>
